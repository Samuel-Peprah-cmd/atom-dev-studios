<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atom Dev Studios </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" type="image/png" href="/static/icons/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/static/icons/favicon.svg" />
    <link rel="shortcut icon" href="/static/icons/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="AtomDevStudios" />
    <link rel="manifest" href="/static/icons/site.webmanifest" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;800&family=Space+Grotesk:wght@300;700&display=swap');
        :root { --neon-green: #00FF41; }
        body { background-color: #050505; color: white; font-family: 'Plus Jakarta Sans', sans-serif; cursor: none; }

        /* Only show custom cursor on devices that actually have a mouse */
        @media (pointer: coarse) {
            #custom-cursor { display: none !important; }
            body { cursor: auto !important; }
        }

        /* Prevent text from hitting the very edges of the phone screen */
        main, section {
            padding-left: 1.5rem !important;
            padding-right: 1.5rem !important;
        }

        @media (min-width: 768px) {
            main, section {
                padding-left: 5rem !important;
                padding-right: 5rem !important;
            }
        }
    </style>
</head>
<body class="antialiased overflow-x-hidden">
    <div id="loader" class="fixed inset-0 bg-black z-[10000] flex flex-col items-center justify-center font-mono">
        <div class="text-[#00FF41] mb-2 tracking-[1em] text-xs">ATOM-DEV-STUDIOS</div>
            <div class="w-48 h-[1px] bg-zinc-800 relative overflow-hidden">
            <div id="progress" class="absolute h-full bg-[#00FF41] w-0 transition-all duration-700"></div>
        </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div id="flash-container" class="fixed top-24 left-1/2 -translate-x-1/2 z-[10001] flex flex-col gap-2 w-[90%] md:max-w-md">
                {% for category, message in messages %}
                    <div class="p-4 md:p-6 rounded-xl border font-mono text-[9px] md:text-[10px] tracking-widest uppercase flex justify-between items-center bg-black/90 border-[#00FF41] text-[#00FF41]">
                        <span>{{ message }}</span>
                        <button onclick="this.parentElement.remove()" class="ml-4 opacity-50 hover:opacity-100"> [X] </button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="scanlines fixed inset-0 pointer-events-none z-50 opacity-10"></div>
    <div id="custom-cursor" class="fixed w-4 h-4 bg-[var(--neon-green)] rounded-full pointer-events-none z-[9999] mix-blend-difference transition-transform duration-100 ease-out"></div>

    <nav class="fixed top-0 w-full p-4 md:p-8 flex flex-col md:flex-row justify-between items-center z-40 mix-blend-difference bg-black/50 md:bg-transparent backdrop-blur-md md:backdrop-blur-none">
        <a href="/" class="flex items-center gap-3 mb-4 md:mb-0">
            <img src="{{ f.logo_url if f.logo_url else 'https://via.placeholder.com/50' }}" 
                alt="Atom Logo" 
                class="h-8 w-8 md:h-10 md:w-10 object-contain rounded-lg border border-[#00FF41]/30">
            <span class="text-xl md:text-2xl font-black tracking-tighter text-white uppercase">
                ATOM<span class="text-[var(--neon-green)]">.</span>
            </span>
        </a>

        <div class="flex flex-wrap justify-center items-center gap-3 md:gap-8 font-mono text-[8px] md:text-[10px] tracking-widest uppercase">
            <a href="{{ url_for('home') }}#work" class="hover:text-[var(--neon-green)] transition-colors text-white">Work</a>
            <a href="{{ url_for('about_page') }}" class="hover:text-[var(--neon-green)] transition-colors text-white">Studio</a>
        
            <a href="mailto:hello@atomdev.com" class="hidden sm:block border border-white/20 px-3 py-1 md:px-4 md:py-2 hover:border-[var(--neon-green)]">Connect</a>

            {% if current_user.is_authenticated %}
                <a href="{{ url_for('admin') }}" class="text-[#00FF41] border-b border-[#00FF41]/30 pb-1">Master</a>
                <a href="{{ url_for('logout') }}" class="text-red-500 opacity-50 hover:opacity-100 transition-opacity">[X]</a>
            {% else %}
                <a href="{{ url_for('home') }}" class="border border-[var(--neon-green)]/50 px-3 py-1 md:px-4 md:py-2 text-white hover:bg-[var(--neon-green)] hover:text-black transition-all">Connect</a>
            {% endif %}
        </div>
    </nav>
    <div id="install-banner" class="fixed bottom-10 right-10 z-[9999] hidden">
        <button onclick="installApp()" class="bg-[#00FF41] text-black px-6 py-3 rounded-full font-bold text-xs shadow-2xl animate-bounce">
            INSTALL ATOM-DEV-STUDIOS
        </button>
    </div>

    {% block content %}{% endblock %}

    <script>
        const cursor = document.getElementById('custom-cursor');
        document.addEventListener('mousemove', (e) => {
            cursor.style.left = e.clientX + 'px';
            cursor.style.top = e.clientY + 'px';
        });
        document.addEventListener('mousedown', () => cursor.style.transform = 'scale(0.8)');
        document.addEventListener('mouseup', () => cursor.style.transform = 'scale(1)');

        window.addEventListener('load', () => {
            const bar = document.getElementById('progress'); // Corrected ID
            const loader = document.getElementById('loader');
        
            let width = 0;
            const interval = setInterval(() => {
                if (width >= 100) {
                    clearInterval(interval);
                    loader.style.opacity = '0';
                    setTimeout(() => loader.style.display = 'none', 1000);
                } else {
                    width += Math.random() * 20;
                    bar.style.width = width + '%';
                }
            }, 150);
        });
    </script>

    <script>
        let deferredPrompt;
        const installBanner = document.getElementById('install-banner');

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js');
        }

        // Capture the "plus" icon/install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBanner.classList.remove('hidden'); // Show your custom button
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install');
                    }
                    installBanner.classList.add('hidden');
                    deferredPrompt = null;
                });
            }
        }
    </script>
</body>
</html>